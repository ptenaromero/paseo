<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quizz</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <style>
        body { background:#f8f9fa }
        .answer-btn { width:100%; text-align:left }
        .answer-btn:disabled { pointer-events:none }
        .question-card.correct .card-header { background:#198754; color:#fff }
        .question-card.incorrect .card-header { background:#dc3545; color:#fff }
        .question-index {
        width:36px; height:36px; border-radius:50%;
        display:inline-flex; align-items:center; justify-content:center;
        font-weight:700; margin-right:.5rem
        }
        .q-img { object-fit:cover; max-height:260px }
        .sticky-actions {
        position:sticky; top:0; z-index:1020;
        background:linear-gradient(#f8f9fa,#f8f9fa 85%,transparent);
        padding-top:.5rem; padding-bottom:.75rem
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark ">
    <div class="container-fluid text-white">
        <span class="navbar-brand">Paseo Didáctico</span>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Alternar navegación">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
            <li class="nav-item">
            <a class="nav-link" aria-current="page" href="../index.html">Inicio</a>
            </li>
            <li class="nav-item">
            <a class="nav-link" href="../ruta.html">La Ruta</a>
            </li>
            <li class="nav-item">
            <a class="nav-link" href="/paseo/ruta/kahoot.html">Actividades</a>
            </li>
            <li class="nav-item">
            <a class="nav-link" href="mailto:pedro.detena.romero@alumnos.upm.es" target="_blank">Contacto</a>
            </li>
            </ul>
        </div>
    </div>
    </nav>

    <div class="container py-4">
        <div class="sticky-actions d-flex flex-column flex-sm-row align-items-start align-items-sm-center justify-content-between gap-2 mb-3">
        <h1 class="h4 m-0 px-3">Quizz</h1>
        <div class="d-flex align-items-center gap-2 flex-wrap">
            <span class="badge text-bg-secondary">
            <span id="answeredCount">0</span>/<span id="totalCount">0</span> respondidas
            </span>
            <button id="resetBtn" class="btn btn-outline-secondary btn-sm">Reiniciar</button>
            <button id="resultsBtn" class="btn btn-primary btn-sm">Ver resultados</button>
        </div>
        </div>

    <div id="quiz" class="vstack gap-4"></div>

        <div id="results" class="mt-4" style="display:none;">
        <div id="scoreSummary"></div>
        <div id="details"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        // Preguntas (10)

        const questions = [
        {
            text: "¿Qué tres elementos químicos se tratan en la ruta?",
            answers: ["Hierro, Cobre y Oro","Sodio, Potasio y Calcio","Platino, Wolframio y Vanadio","Plata, Tungsteno y Cobre"],
            correct: 2,
            image: null
        },
        {
            text: "¿Qué institución madrileña se menciona como centro de estudios de del Río?",
            answers: ["Real Academia de San Fernando","Reales Estudios de San Isidro","Universidad Complutense","Junta para la Ampliación de Estudios"],
            correct: 1,
            image: "../assets/Instituto_de_sanisidro.jpg"
        },
        {
            text: "¿Por qué es importante el Palacio de las Cortes en la ruta?",
            answers: ["Porque allí se firmó la independencia de América","Porque guardaba las colecciones del Jardín Botánico","Porque fue la primera universidad de Madrid","Porque en un edificio cercano vivió y trabajó Fausto de Elhuyar"],
            correct: 3,
            image: "../assets/parada7/p_cortes.jpg"
        },
        {
            text: "¿En qué parque madrileño se encuentran los restos de la Real Fábrica de Porcelana del Buen Retiro?",
            answers: ["Casa de Campo","Parque de El Retiro","Parque del Oeste","Jardines de Sabatini"],
            correct: 1,
            image: null
        },
        {
            text: "¿Quién descubrió el vanadio, que llamó inicialmente \"eritronio\"?",
            answers: ["Agustín de Betancourt","Luis Proust","Andrés Manuel del Río","Juan de Villanueva"],
            correct: 2,
            image: null
        },
        {
            text: "¿Qué edificio formaba parte del proyectado eje de las ciencias junto al Gabinete de Historia Natural y el Jardín Botánico?",
            answers: ["Real Observatorio de Madrid","Palacio de Fomento","Palacio de Minería","Palacio de las Cortes"],
            correct: 0,
            image: "../assets/parada2/observatorio4.jpg"
        },
        {
            text: "¿Qué personaje está asociado al descubrimiento del platino?",
            answers: ["Andrés Manuel del Río","Ninguno de los anteriores","Antonio de Ulloa","Celestino Mutis"],
            correct: 2,
            image: null
        },
        {
            text: "¿Cuál era la función principal del Real Jardín Botánico en el siglo XVIII?",
            answers: ["Ser un simple jardín ornamental","Estudio y enseñanza de la botánica y organización de expediciones","Almacén de armas y pólvora","Servir como palacio de recreo real"],
            correct: 1,
            image: "../assets/parada4/jardin_bot_1.jpg"
        },
        {
            text: "¿Dónde desarrollaron Fausto de Elhuyar y Andrés del Río gran parte de su labor docente e investigadora en minería?",
            answers: ["En la Casa de la Platina (Madrid)","En el Palacio de Minería de Ciudad de México","En la Real Academia de Guardiamarinas (Cádiz)","En la Escuela de Caminos de Madrid"],
            correct: 1,
            image: null
        },
        {
            text: "Uno de los objetivos del paseo didáctico es mostrar que...",
            answers: ["Los descubrimientos químicos fueron obra de un solo genio aislado","La minería en América no tuvo relación con la ciencia europea","La Ilustración española impulsó ciencia, minería y expediciones","España estuvo desconectada de la Revolución Científica"],
            correct: 2,
            image: null
        }
        ];

        // Estado + refs

        const quizEl = document.getElementById('quiz');
        const answeredCountEl = document.getElementById('answeredCount');
        const totalCountEl = document.getElementById('totalCount');
        const resultsSection = document.getElementById('results');
        const scoreSummaryEl = document.getElementById('scoreSummary');
        const detailsEl = document.getElementById('details');
        const resultsBtn = document.getElementById('resultsBtn');
        const resetBtn = document.getElementById('resetBtn');

        let selections = Array(questions.length).fill(null);
        totalCountEl.textContent = questions.length;

        // Render

        function renderQuiz() {
        quizEl.innerHTML = "";
        selections = Array(questions.length).fill(null);
        answeredCountEl.textContent = "0";
        resultsSection.style.display = "none";

        questions.forEach((q, qi) => {
            const card = document.createElement('div');
            card.className = 'card shadow-sm question-card';

            const header = document.createElement('div');
            header.className = 'card-header d-flex align-items-center';
            header.innerHTML = `
            <span class="question-index bg-primary text-white">${qi+1}</span>
            <span class="fw-semibold">${escapeHtml(q.text)}</span>
            `;

            const body = document.createElement('div');
            body.className = 'card-body';

            if (q.image) {
            const img = document.createElement('img');
            img.src = q.image;
            img.alt = 'imagen pregunta';
            img.className = 'img-fluid rounded mb-3 q-img w-100';
            body.appendChild(img);
            }

            const list = document.createElement('div');
            list.className = 'vstack gap-2';
            q.answers.forEach((ans, ai) => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'btn btn-outline-secondary answer-btn';
            btn.textContent = ans;
            btn.dataset.qi = qi;
            btn.dataset.ai = ai;
            btn.addEventListener('click', onAnswerClick);
            list.appendChild(btn);
            });

            body.appendChild(list);
            card.appendChild(header);
            card.appendChild(body);
            quizEl.appendChild(card);
        });
        }

        function onAnswerClick(e) {
        const btn = e.currentTarget;
        const qi = Number(btn.dataset.qi);
        const ai = Number(btn.dataset.ai);
        const q = questions[qi];
        if (selections[qi] !== null) return;

        selections[qi] = ai;

        const card = quizEl.children[qi];
        const buttons = card.querySelectorAll('.answer-btn');
        buttons.forEach((b, idx) => {
            b.disabled = true;
            if (idx === q.correct) {
            b.classList.remove('btn-outline-secondary');
            b.classList.add('btn-success','text-white');
            }
            if (idx === ai && idx !== q.correct) {
            b.classList.remove('btn-outline-secondary');
            b.classList.add('btn-danger','text-white');
            }
        });

        if (ai === q.correct) { card.classList.add('correct'); }
        else { card.classList.add('incorrect'); }

        updateAnsweredCounter();
        }

        function updateAnsweredCounter() {
        const answered = selections.filter(v => v !== null).length;
        answeredCountEl.textContent = answered.toString();
        }

        function computeResults() {
        let score = 0;
        const perQuestion = questions.map((q,i) => {
            const chosen = selections[i];
            const correct = q.correct;
            const ok = chosen === correct;
            if (ok) score++;
            return { index:i+1, ok, chosen, correct, q };
        });
        return { score, perQuestion, total: questions.length };
        }

        function renderResults() {
        const { score, perQuestion, total } = computeResults();
        const pct = Math.round((score/total)*100);
        scoreSummaryEl.innerHTML = `
            <div class="alert ${score === total ? 'alert-success' : score >= total/2 ? 'alert-primary' : 'alert-warning'}" role="alert">
            <strong>Puntuación:</strong> ${score} / ${total} (${pct}%)
            </div>
        `;
        detailsEl.innerHTML = perQuestion.map(({ index, ok, chosen, correct, q }) => {
            const badge = ok ? '<span class="badge text-bg-success">Correcta</span>'
                            : '<span class="badge text-bg-danger">Incorrecta</span>';
            const chosenText = chosen !== null ? escapeHtml(q.answers[chosen]) : 'Sin responder';
            const correctText = escapeHtml(q.answers[correct]);
            return `
            <div class="card mb-2">
                <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <h6 class="mb-2">Pregunta ${index}: ${escapeHtml(q.text)}</h6>
                    ${badge}
                </div>
                <p class="mb-1"><strong>Tu respuesta:</strong> ${chosenText}</p>
                <p class="mb-0"><strong>Correcta:</strong> ${correctText}</p>
                </div>
            </div>
            `;
        }).join('');
        resultsSection.style.display = 'block';
        resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function resetQuiz() {
        renderQuiz();
        window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function escapeHtml(str) {
        return String(str).replace(/[&<>"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s]));
        }

        // Eventos
        resultsBtn.addEventListener('click', renderResults);
        resetBtn.addEventListener('click', resetQuiz);

        // Inicio
        renderQuiz();
    </script>
</body>
</html>
